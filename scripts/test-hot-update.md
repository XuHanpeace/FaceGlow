# Pushy 热更新测试指南

## 测试流程

### 第一步：发布 TestFlight 版本（包含 Pushy SDK）

1. **运行完整发布脚本**（首次发布，包含原生代码）：
   ```bash
   node scripts/release-ios.js
   ```

2. **在 Xcode 中完成 Archive 和 Export**：
   - 按照脚本提示完成 Archive
   - 选择 "Custom" -> "App Store Connect" -> "Export"
   - 提供 IPA 文件路径给脚本

3. **脚本会自动**：
   - 上传 IPA 到 Pushy（作为基准包）
   - 上传 JS Bundle
   - 尝试自动绑定（如果失败，需要手动绑定）

4. **上传到 TestFlight**：
   - 将导出的 IPA 上传到 App Store Connect
   - 等待处理完成后，添加到 TestFlight 测试组
   - 安装到测试设备

### 第二步：修改代码并发布热更新

1. **修改 JavaScript 代码**（例如修改某个页面的文字或样式）

2. **运行热更新发布脚本**（只更新 JS，不修改原生代码）：
   ```bash
   node scripts/publish-hot-update.js
   ```

3. **脚本会自动**：
   - 只更新 `jsVersion`（例如：1.0.11 -> 1.0.12）
   - 保持 `appVersion` 不变（仍然是 1.0.11）
   - 上传新的 JS Bundle
   - 尝试自动绑定到对应的原生版本

### 第三步：验证热更新

1. **在已安装 TestFlight 版本的设备上**：
   - 完全关闭 App（从后台划掉）
   - 重新打开 App
   - Pushy SDK 会自动检查更新
   - 如果有新版本，会自动下载并应用

2. **检查更新状态**：
   - 查看 App 的 "关于我们" 页面
   - 应该看到：`App v1.0.11 (Bundle v1.0.12)`
   - 说明热更新已生效

3. **验证代码修改**：
   - 检查您修改的代码是否已生效
   - 例如：修改的文字或样式是否已更新

## 版本号说明

- **appVersion**：原生应用版本号，只有修改原生代码或发布新版本时才更新
- **jsVersion**：JavaScript Bundle 版本号，每次发布热更新时自动递增

## 注意事项

1. **首次发布必须包含原生代码**：因为 Pushy SDK 需要集成在原生代码中
2. **热更新只能更新 JS**：不能修改原生代码、添加新的 Native Module 等
3. **版本绑定很重要**：热更新包必须绑定到对应的原生版本，否则无法推送
4. **测试环境**：建议先在 TestFlight 环境测试，确认无误后再发布到生产环境

## 常见问题

**Q: 为什么我的热更新没有生效？**
- 检查是否已绑定到正确的原生版本
- 检查设备网络是否正常
- 检查 Pushy 后台是否有新版本
- 尝试完全关闭 App 后重新打开

**Q: 如何查看当前 Bundle 版本？**
- 打开 App -> "关于我们" 页面
- 查看显示的版本号格式：`App v1.0.11 (Bundle v1.0.12)`

**Q: 可以回滚热更新吗？**
- 可以在 Pushy 后台禁用某个热更新包
- 或者发布一个新的热更新包来覆盖

