# iOS 应用内订阅沙盒测试完整指南

## 🎯 测试目标
在沙盒环境中测试iOS应用内订阅功能，包括：
- 产品信息获取
- 购买流程
- 恢复购买
- 订阅状态检查

## 📋 前置条件检查

### 1. Apple Developer 账户
- ✅ 付费开发者账户 ($99/年)
- ✅ App Store Connect 访问权限
- ✅ 税务和银行信息已配置

### 2. App Store Connect 配置
- ✅ 应用已创建：`com.faceglow.app`
- ✅ 产品ID已配置：
  - `com.faceglow.weekly` - 周付会员
  - `com.faceglow.monthly` - 月付会员  
  - `com.faceglow.yearly` - 年付会员
- ✅ 产品状态为 "Ready for Sale"
- ✅ 订阅组已创建：`FaceGlow Premium`

### 3. 沙盒测试账户
- ✅ 在 App Store Connect 中创建沙盒测试账户
- ✅ 在设备上登录沙盒测试账户：
  - 设置 → App Store → 沙盒账户
  - 使用沙盒测试账户登录

## 🚀 测试步骤

### 步骤1：启动应用
```bash
# 在项目根目录运行
npx react-native run-ios
```

### 步骤2：导航到测试页面
1. 打开应用
2. 点击底部导航的"测试中心"
3. 选择"订阅功能测试"

### 步骤3：执行测试

#### A. 环境检查
- 点击"检查沙盒环境"
- 验证所有配置项都显示为 ✅

#### B. 基础功能测试
1. **获取产品信息**
   - 点击"获取产品信息"
   - 检查控制台日志，确认产品列表正确加载
   - 验证产品价格和描述

2. **检查订阅状态**
   - 点击"检查订阅状态"
   - 验证返回的订阅信息

3. **恢复购买**
   - 点击"恢复购买"
   - 测试恢复购买功能

#### C. 购买测试
1. **测试周付购买**
   - 点击"测试周付购买"
   - 观察支付流程
   - 验证购买结果

2. **测试年付购买**
   - 点击"测试年付购买"
   - 观察支付流程
   - 验证购买结果

#### D. 完整测试套件
- 点击"运行完整测试套件"
- 等待所有测试完成
- 查看测试结果汇总

## 🔍 测试检查点

### 成功场景
- ✅ 产品信息正确加载
- ✅ 支付流程顺利完成
- ✅ 订阅状态正确更新
- ✅ 恢复购买功能正常
- ✅ 错误处理机制有效

### 失败场景
- ❌ 产品获取失败
- ❌ 支付流程中断
- ❌ 订阅状态错误
- ❌ 恢复购买失败

## 🐛 常见问题排查

### 1. 产品获取失败
**症状：** 控制台显示 "获取产品失败"
**可能原因：**
- 产品ID在 App Store Connect 中未创建
- 产品状态不是 "Ready for Sale"
- Bundle ID 不匹配
- 网络连接问题

**解决方案：**
1. 检查 App Store Connect 中的产品配置
2. 确认产品状态为 "Ready for Sale"
3. 验证 Bundle ID 匹配
4. 检查网络连接

### 2. 支付失败
**症状：** 支付过程中出现错误
**可能原因：**
- 未登录沙盒测试账户
- 设备不支持应用内购买
- 沙盒环境配置错误

**解决方案：**
1. 确认已登录沙盒测试账户
2. 检查设备是否支持应用内购买
3. 重新配置沙盒环境

### 3. 恢复购买失败
**症状：** 恢复购买时显示 "没有可恢复的购买"
**可能原因：**
- 没有之前的购买记录
- 沙盒账户不匹配

**解决方案：**
1. 先进行一次购买测试
2. 确认使用相同的沙盒账户

## 📊 测试结果记录

### 测试环境信息
- **设备：** iPhone [型号]
- **iOS版本：** [版本号]
- **应用版本：** [版本号]
- **沙盒账户：** [账户邮箱]

### 测试结果
| 测试项目 | 状态 | 备注 |
|---------|------|------|
| 环境检查 | ✅/❌ | |
| 获取产品信息 | ✅/❌ | |
| 检查订阅状态 | ✅/❌ | |
| 恢复购买 | ✅/❌ | |
| 周付购买 | ✅/❌ | |
| 年付购买 | ✅/❌ | |
| 完整测试套件 | ✅/❌ | |

### 问题记录
- **问题描述：** [详细描述]
- **复现步骤：** [步骤]
- **预期结果：** [预期]
- **实际结果：** [实际]
- **解决方案：** [方案]

## 🎉 测试完成

当所有测试项目都通过时，说明iOS应用内订阅功能在沙盒环境中工作正常，可以进入下一阶段的测试或发布准备。

## 📞 技术支持

如果遇到无法解决的问题，请：
1. 检查控制台日志
2. 查看错误信息
3. 参考Apple官方文档
4. 联系开发团队
